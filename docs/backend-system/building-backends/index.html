<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>Building Backends · Backstage Software Catalog and Developer Platform</title><meta name="viewport" content="width=device-width, initial-scale=1.0"/><meta name="generator" content="Docusaurus"/><meta name="description" content="Building backends using the new backend system"/><meta name="docsearch:language" content="en"/><meta property="og:title" content="Building Backends · Backstage Software Catalog and Developer Platform"/><meta property="og:type" content="website"/><meta property="og:url" content="https://backstage.io/"/><meta property="og:description" content="Building backends using the new backend system"/><meta property="og:image" content="https://backstage.io/img/sharing-opengraph.png"/><meta name="twitter:card" content="summary"/><meta name="twitter:image" content="https://backstage.io/img/twitter-summary.png"/><link rel="shortcut icon" href="/img/favicon.ico"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.css"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/monokai.min.css"/><link rel="alternate" type="application/atom+xml" href="https://backstage.io/blog/atom.xml" title="Backstage Software Catalog and Developer Platform Blog ATOM Feed"/><link rel="alternate" type="application/rss+xml" href="https://backstage.io/blog/feed.xml" title="Backstage Software Catalog and Developer Platform Blog RSS Feed"/><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-KSEVGGNCJW"></script><script>
              window.dataLayer = window.dataLayer || [];
              function gtag(){dataLayer.push(arguments); }
              gtag('js', new Date());
              gtag('config', 'G-KSEVGGNCJW');
            </script><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=IBM+Plex+Mono:500,700&amp;display=swap"/><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><script type="text/javascript" src="https://unpkg.com/medium-zoom@1.0.6/dist/medium-zoom.min.js"></script><script type="text/javascript" src="/js/medium-zoom.js"></script><script type="text/javascript" src="/js/dismissable-banner.js"></script><script type="text/javascript" src="/js/scroll-nav-to-view-in-docs.js"></script><script src="/js/scrollSpy.js"></script><link rel="stylesheet" href="/css/main.css"/><script src="/js/codetabs.js"></script></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/"><h2 class="headerTitle">Backstage Software Catalog and Developer Platform</h2></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class=""><a href="https://github.com/backstage/backstage" target="_self">GitHub</a></li><li class=""><a href="/docs/overview/what-is-backstage" target="_self">Docs</a></li><li class=""><a href="/plugins" target="_self">Plugins</a></li><li class=""><a href="/blog" target="_self">Blog</a></li><li class=""><a href="/docs/releases/v1.10.0" target="_self">Releases</a></li><li class=""><a href="/demos" target="_self">Demos</a></li><li class=""><a href="/community" target="_self">Community</a></li><li class="navSearchWrapper reactNavSearchWrapper"><input type="text" id="search_input_react" placeholder="Search" title="Search"/></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="container mainContainer docsContainer"><div class="wrapper"><div class="post"><header class="postHeader"><a class="edit-page-link button" href="https://github.com/backstage/backstage/edit/master/docs/backend-system/building-backends/01-index.md" target="_blank" rel="noreferrer noopener">Edit</a><h1 id="__docusaurus" class="postHeaderTitle">Building Backends</h1></header><article><div><span><blockquote>
<p>NOTE: If you have an existing backend that is not yet using the new backend
system, see <a href="/docs/backend-system/building-backends/migrating">migrating</a>.</p>
</blockquote>
<h1><a class="anchor" aria-hidden="true" id="overview"></a><a href="#overview" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Overview</h1>
<p>A minimal Backstage backend is very lightweight. It is a single package with a <code>package.json</code> file and a <code>src/index.ts</code> file, not counting surrounding tooling and documentation. The package is typically placed within the <code>packages/backend</code> folder of a Backstage monorepo, but that is up to you. The backend package is part of any project created with <code>@backstage/create-app</code>, so you typically do not need to create it yourself.</p>
<p>You'll get a brief description here, but for a more in-depth explanation of the role of backends in the backend system, see <a href="/docs/backend-system/architecture/backends">the architecture section</a>.</p>
<p>When you create a new project with <code>@backstage/create-app</code>, you'll get a backend package with a <code>src/index.ts</code> that looks something like this:</p>
<pre><code class="hljs css language-ts"><span class="hljs-keyword">import</span> { createBackend } <span class="hljs-keyword">from</span> <span class="hljs-string">'@backstage/backend-defaults'</span>;
<span class="hljs-keyword">import</span> { appPlugin } <span class="hljs-keyword">from</span> <span class="hljs-string">'@backstage/plugin-app-backend'</span>;
<span class="hljs-keyword">import</span> { catalogPlugin } <span class="hljs-keyword">from</span> <span class="hljs-string">'@backstage/plugin-catalog-backend'</span>;
<span class="hljs-keyword">import</span> {
  scaffolderPlugin,
  catalogModuleTemplateKind,
} <span class="hljs-keyword">from</span> <span class="hljs-string">'@backstage/plugin-scaffolder-backend'</span>;

<span class="hljs-keyword">const</span> backend = createBackend();

backend.add(appPlugin());
backend.add(catalogPlugin());
backend.add(catalogModuleTemplateKind());
backend.add(scaffolderPlugin());

backend.start();
</code></pre>
<p>There will be a couple more plugins and modules in the initial setup, but the overall layout is the same.</p>
<p>What we're doing in this file is creating a new backend using <code>createBackend</code>, and then installing a collection of different plugins and modules that we want to be part of that backend. Plugins are standalone features, while modules augment existing plugins. Each module can only target a single plugin, and that plugin must also be present in the same backend. Finally, we start up the backend by calling the <code>start</code> method.</p>
<h2><a class="anchor" aria-hidden="true" id="customization"></a><a href="#customization" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Customization</h2>
<p>Apart from installing existing plugins and modules in the backend, there are a couple of different ways in which you can customize your backend installation.</p>
<h3><a class="anchor" aria-hidden="true" id="configuration"></a><a href="#configuration" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Configuration</h3>
<p>Perhaps the most accessible way is though static configuration, which you can read more about in the documentation for how to <a href="/docs/conf/writing">write configuration</a>. Many different aspects of the backend can be configured, including both the behavior of the backend itself, as well as many plugins or modules. You'll need to refer to the documentation of each plugin or module to see what configuration is available. Also be sure to check out the documentation of the <a href="/docs/backend-system/core-services/">core services</a>, as that also covers how to configure those.</p>
<h3><a class="anchor" aria-hidden="true" id="services"></a><a href="#services" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Services</h3>
<p>Speaking of services, they are another important point of customization. Services allow you to make deeper and broader customizations of the backend. They are similar to <a href="/docs/api/utility-apis">Utility APIs</a> in the frontend system, using dependency injection to make common functionality available to plugins and modules. You can read more about services in the <a href="/docs/backend-system/architecture/services">architecture section</a>.</p>
<p>There is a core set of services that must be installed in all backends, for things like logging, database access, serving HTTP, and so on. Luckily, all of these services are installed by default when you use <code>createBackend</code> from the <code>@backstage/backend-defaults</code> package, which is what you have in a standard setup.</p>
<p>All of these services can be replaced with your own implementations if you need to customize them. The simplest way to do this is to use the existing service implementations but with additional options. Many of the core services can be customized this way, but not all, as they don't all have meaningful options.</p>
<p>For example, let's say we want to customize the core configuration service to enable remote configuration loading. That would look something like this:</p>
<pre><code class="hljs css language-ts"><span class="hljs-keyword">import</span> { configFactory } <span class="hljs-keyword">from</span> <span class="hljs-string">'@backstage/backend-app-api'</span>;

<span class="hljs-keyword">const</span> backend = createBackend({
  services: [
    configFactory({
      remote: { reloadIntervalSeconds: <span class="hljs-number">60</span> },
    }),
  ],
});
</code></pre>
<p>This will make it possible to pass URLs as configuration targets, and those URLs will be polled every 60 seconds for changes.</p>
<p>There is one exception to the above, which is the built-in <code>PluginMetadataService</code> that is provided by the framework and is not possible to override.</p>
<h3><a class="anchor" aria-hidden="true" id="custom-service-implementations"></a><a href="#custom-service-implementations" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Custom Service Implementations</h3>
<p>When overriding services you are not limited to the existing implementations, you can also provide your own custom service factories. This will let you globally override services with completely custom implementations, or build on existing implementations to add additional logic.</p>
<p>To override a service, you provide it in the <code>services</code> option just like above, but this time we need to use <code>createServiceFactory</code> to create our factory. For example, if you want to replace the default <code>LoggerService</code> with your own, it might look like this:</p>
<pre><code class="hljs css language-ts"><span class="hljs-keyword">const</span> backend = createBackend({
  services: [
    createServiceFactory({
      service: coreServices.logger,
      deps: {
        rootLogger: coreServices.rootLogger,
        plugin: coreServices.pluginMetadata,
        config: coreServices.config,
      },
      factory({ rootLogger, plugin, config }) {
        <span class="hljs-keyword">const</span> labels = readCustomLogLabelsForPlugin(config, plugin); <span class="hljs-comment">// custom logic</span>
        <span class="hljs-keyword">return</span> rootLogger.child(labels);
      },
    }),
  ],
});
</code></pre>
<p>The <code>LoggerService</code> is responsible for creating a specialized logger instance for each plugin, while the <code>RootLoggerService</code> is the actual logging implementation. The default implementation of <code>LoggerService</code> will decorate the logger with a <code>plugin</code> label that contains the plugin ID. Here in our custom implementation we read out additional labels from the configuration and add those as well.</p>
<p>This example touches on the fact that services can have different scopes, being either scoped to individual plugins or the root backend instance. To read more about this, see the <a href="/docs/backend-system/architecture/services">architecture section</a>.</p>
<h2><a class="anchor" aria-hidden="true" id="split-into-multiple-backends"></a><a href="#split-into-multiple-backends" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Split Into Multiple Backends</h2>
<blockquote>
<p>NOTE: Splitting into multiple backends is an advanced deployment pattern that requires significant effort and there are not yet many built-in tools in the framework to help you out. Only use this if necessary.</p>
</blockquote>
<p>A more advanced way to deploy Backstage is to split the backend plugins into multiple different backend deployments. Both the <a href="/docs/deployment/scaling">deployment documentation</a> and <a href="/docs/overview/threat-model#trust-model">Threat Model</a> explain the benefits of this, so here we'll focus on how to do it.</p>
<p>To create a separate backend we need to create an additional backend package. This package will be built and deployed separately from your existing backend. There is currently no template to create a backend via <code>yarn new</code>, so the quickest way is to copy the new package and modify. The naming is up to you and it depends on how you are splitting things and up. For this example we'll just use a simple suffix. You might end up with a directory structure like this:</p>
<pre><code class="hljs css language-text">packages/
  backend-a/
    src/
      index.ts
    package.json <- "name": "backend-a"
  backend-b/
    src/
      index.ts
    package.json <- "name": "backend-b"
</code></pre>
<p>You can now trim down the <code>src/index.ts</code> files to only include the plugins and modules that you want to be part of that backend. For example, if you want to split out the scaffolder plugin, you might end up with something like this:</p>
<pre><code class="hljs css language-ts"><span class="hljs-comment">// packages/backend-a/src/index.ts, imports omitted</span>
<span class="hljs-keyword">const</span> backend = createBackend();

backend.add(appPlugin());
backend.add(catalogPlugin());
backend.add(catalogModuleTemplateKind());
backend.start();
</code></pre>
<p>And <code>backend-b</code>, don't forget to clean up dependencies in <code>package.json</code> as well:</p>
<pre><code class="hljs css language-ts"><span class="hljs-comment">// packages/backend-b/src/index.ts, imports omitted</span>
<span class="hljs-keyword">const</span> backend = createBackend();

backend.add(scaffolderPlugin());
backend.start();
</code></pre>
<p>We've now split the backend into two separate deployments, but we still need to make sure that they can communicate with each other. This is the hard and somewhat tedious part, as Backstage currently doesn't provide an out of the box solution that solves this. You'll need to manually configure the two backends with custom implementations of the <code>DiscoveryService</code> and have them return the correct URLs for each other. Likewise, you'll also need to provide a custom implementation of the <code>DiscoveryApi</code> in the frontend, unless you surface the two backends via a proxy that handles the routing instead.</p>
<h3><a class="anchor" aria-hidden="true" id="shared-environments"></a><a href="#shared-environments" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Shared Environments</h3>
<p>To make it a bit easier to manage multiple backends, it's possible to create a shared environment that can be used across multiple backends. You would typically house it in a separate package that can be referenced by backends in your monorepo, or published to a package registry for broader use.</p>
<p>A shared environment contains a set of service implementations that should be used across all backends. These services will override the default ones, but if a service is provided directly to the backend, it will override the one in the shared environment.</p>
<p>A shared environment is defined using <code>createSharedEnvironment</code>. In this example we place it in a new and separate package called <code>backend-env</code>:</p>
<pre><code class="hljs css language-ts"><span class="hljs-comment">// packages/backend-env/src/index.ts</span>
<span class="hljs-keyword">import</span> { createSharedEnvironment } <span class="hljs-keyword">from</span> <span class="hljs-string">'@backstage/backend-plugin-api'</span>;
<span class="hljs-keyword">import</span> { customDiscoveryFactory } <span class="hljs-keyword">from</span> <span class="hljs-string">'./customDiscoveryFactory'</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> env = createSharedEnvironment({
  services: [
    customDiscoveryFactory(), <span class="hljs-comment">// custom DiscoveryService implementation</span>
  ],
});
</code></pre>
<p>And passed on to backends using the <code>env</code> option:</p>
<pre><code class="hljs css language-ts"><span class="hljs-comment">// packages/backend-b/src/index.ts, imports omitted</span>
<span class="hljs-keyword">import</span> { env } <span class="hljs-keyword">from</span> <span class="hljs-string">'@internal/backend-env'</span>;

<span class="hljs-keyword">const</span> backend = createBackend({ env });

backend.add(scaffolderPlugin());
backend.start();
</code></pre>
</span></div></article></div><div class="docLastUpdate"><em>Last updated on 1/30/2023</em></div><div class="docs-prevnext"></div></div></div><nav class="onPageNav"><ul class="toc-headings"><li><a href="#customization">Customization</a><ul class="toc-headings"><li><a href="#configuration">Configuration</a></li><li><a href="#services">Services</a></li><li><a href="#custom-service-implementations">Custom Service Implementations</a></li></ul></li><li><a href="#split-into-multiple-backends">Split Into Multiple Backends</a><ul class="toc-headings"><li><a href="#shared-environments">Shared Environments</a></li></ul></li></ul></nav></div><footer class="nav-footer" id="footer"><section class="sitemap"><div class="footer-title"><a href="/"><h2 class="footerLogo"></h2></a></div><div><h5>Docs</h5><a href="/docs/overview/what-is-backstage">What is Backstage?</a><a href="/docs/getting-started/">Getting started</a><a href="/docs/features/software-catalog/software-catalog-overview">Software Catalog</a><a href="/docs/plugins/create-a-plugin">Create a Plugin</a><a href="/docs/dls/design">Designing for Backstage</a></div><div><h5>Community</h5><a href="https://discord.gg/MUpMjP2">Support chatroom</a><a href="https://github.com/backstage/backstage/blob/master/CONTRIBUTING.md">Contributing</a><a href="https://backstage.spotify.com">Adopting</a><a href="https://github.com/backstage/community">Community Sessions</a><a href="https://info.backstage.spotify.com/newsletter_subscribe">Subscribe to our newsletter</a><a href="https://www.cncf.io/projects/">CNCF Incubation</a></div><div><h5>More</h5><a href="https://spotify.github.io/">Open Source @ Spotify</a><a href="https://engineering.atspotify.com/">Spotify Engineering Blog</a><a href="https://developer.spotify.com/">Spotify for Developers</a><a href="https://github.com/backstage/backstage">GitHub</a><a class="github-button" href="https://github.com/backstage/backstage" data-icon="octicon-star" data-count-href="/backstage/backstage/stargazers" data-show-count="true" data-count-aria-label="# stargazers on GitHub" aria-label="Star this project on GitHub">Star</a><div class="social"><a href="https://twitter.com/SpotifyEng" class="twitter-follow-button">Follow @SpotifyEng</a></div></div></section><p style="text-align:center"><a href="https://spotify.github.io">Made with ❤️ at Spotify</a></p><p class="copyright">Copyright © 2023 Backstage Project Authors. All rights reserved. The Linux Foundation has registered trademarks and uses trademarks. For a list of trademarks of The Linux Foundation, please see our Trademark Usage page: https://www.linuxfoundation.org/trademark-usage</p></footer></div><script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.js"></script><script>window.twttr=(function(d,s, id){var js,fjs=d.getElementsByTagName(s)[0],t=window.twttr||{};if(d.getElementById(id))return t;js=d.createElement(s);js.id=id;js.src='https://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js, fjs);t._e = [];t.ready = function(f) {t._e.push(f);};return t;}(document, 'script', 'twitter-wjs'));</script><script>
                document.addEventListener('keyup', function(e) {
                  if (e.target !== document.body) {
                    return;
                  }
                  // keyCode for '/' (slash)
                  if (e.keyCode === 191) {
                    const search = document.getElementById('search_input_react');
                    search && search.focus();
                  }
                });
              </script><script>
              var search = docsearch({
                
                apiKey: '8d115c9875ba0f4feaee95bab55a1645',
                indexName: 'backstage',
                inputSelector: '#search_input_react'
              });
            </script></body></html>